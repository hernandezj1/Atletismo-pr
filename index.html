<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Récords de Atletismo de Puerto Rico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%);
            min-height: 100vh;
        }
    </style>
</head>
<body class="font-sans">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Encabezado -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-blue-900 mb-4">Récords de Atletismo de Puerto Rico</h1>
            
            <!-- Párrafo de introducción -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-8 max-w-4xl mx-auto">
                <div id="intro-display" class="text-gray-700 leading-relaxed text-lg">
                    Esta no es una base de datos oficial. Fue compilada por José Hernández 
                    entrenador en Cupey Track y entrenador de lanzamientos Nivel II certificado por USATF. 
                    Utilizamos recursos desarrollados por Pedro Aníbal Díaz, a quien damos crédito por su 
                    trabajo que nos permite mantener y actualizar estos récords en la actualidad. 
                    Nuestro objetivo fue continuar su legado más allá de la temporada 2023 los cuales están resumidos en su libro <i>Marcas y Medallas</i>.
                </div>
            </div>
        </div>

        <!-- Controles -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Selección de género -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-3">Categoría</label>
                    <select id="gender-select" class="w-full p-3 border border-gray-300 rounded-lg bg-white text-gray-700 font-medium">
                        <option value="male">Récords Masculinos</option>
                        <option value="female">Récords Femeninos</option>
                    </select>
                </div>

                <!-- Selección de evento -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-3">Evento</label>
                    <select id="event-select" class="w-full p-3 border border-gray-300 rounded-lg bg-white text-gray-700 font-medium">
                        <optgroup label="Velocidad">
                            <option value="100m">100m</option>
                            <option value="200m">200m</option>
                            <option value="400m">400m</option>
                        </optgroup>
                    </select>
                </div>
            </div>
        </div>

        <!-- Tabla de Récords -->
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <div class="bg-blue-600 text-white p-4">
                <h2 id="table-title" class="text-xl font-bold">Top 10 - Masculino 100m</h2>
            </div>
            
            <div id="loading" class="p-8 text-center text-gray-600">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"></div>
                <p>Cargando récords desde Google Sheets...</p>
            </div>

            <div id="records-container" class="hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr id="table-headers"></tr>
                        </thead>
                        <tbody id="records-tbody" class="divide-y divide-gray-200"></tbody>
                    </table>
                </div>
            </div>

            <div id="error-message" class="hidden p-8 text-center text-red-600">
                <p class="font-medium">No se pudieron cargar los récords en este momento.</p>
                <p class="text-sm mt-2">Verifica tu conexión a internet e intenta nuevamente.</p>
            </div>
        </div>

        <!-- Pie de página -->
        <div class="text-center mt-8 text-gray-600">
            <p class="text-sm">Datos provenientes de récords oficiales de Atletismo de Puerto Rico</p>
        </div>
    </div>

    <script>
        const genderSelect = document.getElementById('gender-select');
        const eventSelect = document.getElementById('event-select');
        const tableTitle = document.getElementById('table-title');
        const tableHeaders = document.getElementById('table-headers');
        const recordsTbody = document.getElementById('records-tbody');
        const loadingDiv = document.getElementById('loading');
        const recordsContainer = document.getElementById('records-container');
        const errorMessage = document.getElementById('error-message');

        // Base URL para hojas publicadas
        const BASE_URL = {
            male: "https://docs.google.com/spreadsheets/d/e/XXXX/pub?gid=GID&single=true&output=csv",
            female: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRAL3BpfUCSYUdrCwTe05sgn6RJ7W6BUm6XOlCGsNESxJZi5hdHtuWQu_VoI9dV271u-KWfJaDC7ZoO/pub?gid=GID&single=true&output=csv"
        };

        // Aquí añades los gid de cada pestaña
        const gidMap = {
            male: {
                "100m": "0",
                "200m": "1017868685",
                "400m": "731359828"
            },
            female: {
                "100m": "0",
                "200m": "1017868685",
                "400m": "731359828"
            }
        };

        async function loadRecords(gender, event) {
            try {
                const url = BASE_URL[gender].replace("GID", gidMap[gender][event]);
                const res = await fetch(url);
                const text = await res.text();
                const rows = text.trim().split("\n").map(r => r.split(","));

                tableHeaders.innerHTML = "";
                recordsTbody.innerHTML = "";

                const headers = ["Ranking", "Marca", "Atleta", "Fecha de Nacimiento", "Lugar", "Fecha"];
                headers.forEach(header => {
                    const th = document.createElement("th");
                    th.className = "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider";
                    th.textContent = header;
                    tableHeaders.appendChild(th);
                });

                rows.slice(1).forEach((row, index) => {
                    const tr = document.createElement("tr");
                    tr.className = index % 2 === 0 ? "bg-white" : "bg-gray-50";

                    row.forEach((cell, i) => {
                        const td = document.createElement("td");
                        td.className = "px-6 py-4 whitespace-nowrap text-sm text-gray-900";
                        if (i === 0) td.classList.add("font-medium");
                        td.textContent = cell;
                        tr.appendChild(td);
                    });
                    recordsTbody.appendChild(tr);
                });

                loadingDiv.classList.add("hidden");
                recordsContainer.classList.remove("hidden");

            } catch (error) {
                loadingDiv.classList.add("hidden");
                errorMessage.classList.remove("hidden");
            }
        }

        function updateTable() {
            const gender = genderSelect.value;
            const event = eventSelect.value;
            const genderText = gender === "male" ? "Masculino" : "Femenino";

            tableTitle.textContent = `Top 10 - ${genderText} ${event}`;
            loadingDiv.classList.remove("hidden");
            recordsContainer.classList.add("hidden");
            errorMessage.classList.add("hidden");

            loadRecords(gender, event);
        }

        genderSelect.addEventListener("change", updateTable);
        eventSelect.addEventListener("change", updateTable);

        updateTable();
    </script>
</body>
</html>
